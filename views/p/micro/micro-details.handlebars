{{#if project}}

<div id="micropostPop">
   <img src="/icons/back-black.png" class="project_bck_btn go-back"/>
   <div class="micropostPop_wrapper">
      <div class="micropostPop_container">

         <div class="micropost">
            <input class="likes_length" type="hidden" name="likes_length" value="{{project.likes.length}}">
            <input class="reposts_length" type="hidden" name="reposts_length" value="{{project.reposts.length}}">
            <input class="saves_length" type="hidden" name="saves_length" value="{{project.saves.length}}">
            <input class="micro_project" type="hidden" name="project_id" value="{{project._id}}">
            <input class="micro_owner" type="hidden" name="project_owner" value="{{project.project_owner}}">
            <div class="micropost_card {{#if project.micro_image}}card_is_micro_image{{else}}{{#if project.micro_audio}}card_is_micro_audio{{else}}{{#if project.micro_video}}card_is_micro_video{{else}}card_is_micro_text{{/if}}{{/if}}{{/if}}">
               {{#if project.micro_image}}<img src="https://s3.amazonaws.com/hryzn-app-static-assets/{{project.micro_image}}" class="img-responsive" alt="{{project.micro_body}}" />{{/if}}
               {{#if project.thumbnail_image}}<img src="https://s3.amazonaws.com/hryzn-app-static-assets/{{project.thumbnail_image}}" class="img-responsive" alt="{{project.micro_body}}" />{{/if}}
               {{#if project.micro_audio}}
               <audio controls controlsList="nodownload" class="micro_audio">
                  <source src="https://s3.amazonaws.com/hryzn-app-static-assets/{{project.micro_audio}}" type="audio/ogg">
                  <source src="https://s3.amazonaws.com/hryzn-app-static-assets/{{project.micro_audio}}" type="audio/mpeg">
                  <source src="https://s3.amazonaws.com/hryzn-app-static-assets/{{project.micro_audio}}" type="audio/wav">
                   Your browser does not support the audio element.
               </audio>
               {{/if}}
               {{#if project.micro_video}}
               <video autoplay preload="auto" controls controlsList="nodownload" class="micro_video">
                  <source src="https://s3.amazonaws.com/hryzn-app-static-assets/{{project.micro_video}}" type="video/mp4">
                  <source src="https://s3.amazonaws.com/hryzn-app-static-assets/{{project.micro_video}}" type="video/ogg">
                  <source src="https://s3.amazonaws.com/hryzn-app-static-assets/{{project.micro_video}}" type="video/webm">
                  Your browser does not support the video tag.
               </video>
               {{/if}}

               <div class="micro_top_action">
                  <a class="micro_tag" href="/profile/{{project.project_owner}}">
                     <div class="topnav__user">
                        <div class="topnav__profile-img-container">
                           <img class="profile__img" src="https://s3.amazonaws.com/hryzn-app-static-assets/{{project.project_owner_profile_image}}">
                        </div>
                        @{{project.project_owner}}
                     </div>
                  </a>

                  <div class="micro_action_btns">
                     {{#if user}}
                        {{#if user_liked}}

                        {{! Like / Unlike Project }}

                        <form title="unlike" method="post" action="/p/details/micro/like/{{project._id}}">
                           <input type="hidden" name="username" value="{{user.username}}">
                           <input type="hidden" name="project_id" value="{{project.id}}">
                           <button class="project_action_btn" name="submit" type="submit">
                              <a>{{#if enough_likes}}<span class="i_amounts">{{likes_amount}}</span>{{/if}}<i style="font-weight: bold" class="fa fa-heart"></i></a>
                           </button>
                        </form>

                        {{else}}

                        <form title="like" method="post" action="/p/details/micro/like/{{project._id}}">
                           <input type="hidden" name="username" value="{{user.username}}">
                           <input type="hidden" name="project_id" value="{{project.id}}">
                           <input type="hidden" name="project_owner" value="{{project.project_owner}}">
                           <button class="project_action_btn" name="submit" type="submit">
                              <a>{{#if enough_likes}}<span class="i_amounts">{{likes_amount}}</span>{{/if}}<i style="font-weight: bold" class="fa fa-heart-o"></i></a>
                           </button>
                        </form>

                        {{/if}}

                     {{else}}

                     <button class="project_action_btn" name="submit" type="submit">
                        <a>{{#if enough_likes}}<span class="i_amounts">{{likes_amount}}</span>{{/if}}<i style="font-weight: bold" class="fa fa-heart-o"></i></a>
                     </button>

                     {{/if}}

                     <button class="project_action_btn" name="submit" type="submit">
                        <a {{#if user}}class="detailsRepostModalBtn"{{/if}}>{{#if enough_reposts}}<span class="i_amounts">{{repost_amount}}</span>{{/if}}<i class="fa fa-retweet"></i></a>
                     </button>


                     {{#if user}}
                        {{#if user_saved}}

                        {{! Save / Unsave Project }}

                        <form title="unsave" method="post" action="/p/details/micro/save/{{project._id}}">
                           <input type="hidden" name="username" value="{{user.username}}">
                           <input type="hidden" name="project_id" value="{{project.id}}">
                           <button class="project_action_btn" name="submit" type="submit">
                              <a>{{#if enough_saves}}<span class="i_amounts">{{saves_amount}}</span>{{/if}}<i style="font-weight: bold" class="fa fa-bookmark"></i></a>
                           </button>
                        </form>

                        {{else}}

                        <form title="save" method="post" action="/p/details/micro/save/{{project._id}}">
                           <input type="hidden" name="username" value="{{user.username}}">
                           <input type="hidden" name="project_id" value="{{project.id}}">
                           <input type="hidden" name="project_owner" value="{{project.project_owner}}">
                           <button class="project_action_btn" name="submit" type="submit">
                              <a>{{#if enough_saves}}<span class="i_amounts">{{saves_amount}}</span>{{/if}}<i style="font-weight: bold" class="fa fa-bookmark-o"></i></a>
                           </button>
                        </form>

                        {{/if}}

                     {{else}}

                     <button class="project_action_btn" name="submit" type="submit">
                        <a>{{#if enough_saves}}<span class="i_amounts">{{saves_amount}}</span>{{/if}}<i style="font-weight: bold" class="fa fa-bookmark-o"></i></a>
                     </button>

                     {{/if}}
                  </div>
               </div>

               {{#if project.project_title}}<p class="micro_title">{{project.project_title}}</p>{{/if}}

               {{#if project.micro_body}}
               <p class="micro_body">
                  {{{project.micro_body}}}
               </p>
               {{/if}}


               {{#if project.project_url}}
               <a target="_blank" class="project_url" href="https://{{project.project_url}}">View Site</a>
               {{/if}}


               <div class="action_btns_social">
                  <a target="_blank" href="http://www.facebook.com/sharer.php?u={{site_url}}/p/details/{{project._id}}/guest&amp;t={{#if project.project_title}}{{project.project_title}}{{else}}Explore On Hryzn{{/if}}" title="Share on Facebook" class="facebook"><i class="fa fa-facebook"></i></a>
                  <a target="_blank" href="https://twitter.com/intent/tweet?original_referer=https%3A%2F%2Fmyhryzn%3A5000%2Fp%2Fdetails%2F{{project._id}}&ref_src=twsrc%5Etfw&text={{#if project.project_title}}{{project.project_title}}{{else}}Explore On Hryzn{{/if}}&tw_p=tweetbutton&url=https%3A%2F%2Fwww.myhryzn.com%2Fp%2Fdetails%2F{{project._id}}%2Fguest&via=myHryzn" title="Share on Twitter" class="twitter"><i class="fa fa-twitter"></i></a>
                  <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
                  <a class="check" class="copy-link" onclick="copyLink('{{site_url}}/p/micro/{{project._id}}/guest')"><i class="fa fa-link"></i></a>
               </div>

               {{#if is_admin_of_project}}
               <div class="micro_action_btns">
                  <div class="modalBtn admin_btn">Delete</div>
               </div>
               {{/if}}
            </div>

            {{! Project Comments }}

            <div class="comment_box">

               <div class="comment_box_comments">
               {{#if project.comments}}
               {{#each project.comments}}
               <div class="project_comment">
                  <a href="/profile/{{this.username}}">
                     <div class="topnav__user">
                        <div class="topnav__profile-img-container">
                           <img class="profile__img comment_profileimage" src="https://s3.amazonaws.com/hryzn-app-static-assets/{{this.profileimage}}">
                        </div>
                        <p class="comment_username">{{this.username}}</p>
                        <div class="{{#if ../user}}del_box{{else}}del_box_off{{/if}}"></div>
                        <p style="display:none" class="comment_id">{{this._id}}</p>
                     </div>
                  </a>
                  <p class="comment_msg">{{{this.message}}}</p>
               </div>
               {{/each}}
               {{else}}
               <p style="text-align: center">There are no comments.</p>
               {{/if}}
               </div>

               {{#if user}}

               <form id="comment" method="post" class="comment_form" action="/p/details/comment/{{project._id}}">
                  <input class="og_path" type="hidden" name="og_path" value="{{og_path}}">
                  <input type="hidden" name="username" value="{{user.username}}">
                  <input type="hidden" name="profileimage" value="{{user.profileimage}}">
                  <input type="hidden" name="project_id" value="{{project._id}}">
                  <input type="hidden" name="project_owner" value="{{project.project_owner}}">
                  <textarea type="text" name="comment" required></textarea>
                  <button class="comment_btn" name="submit" type="submit">Send Comment</button>
               </form>

               {{/if}}

            </div>

         </div>

      </div>
   </div>
</div>

{{/if}}

{{#if projects}}
<div class="explore_main">
   <div id="masonryContainer" class="masonryContainer">

      {{#each projects}}

         {{#if is_private}}
         {{! Can't show private projects to people other than logged in User }}
         {{else}}

            {{#if is_micro_post}}

            {{#if posted_to_group}}
               {{#each posted_to_group}}
                  {{#ifEquals this.group_is_private "true"}}
                     {{! Don't show projects in private groups }}
                  {{else}}
                     <div class="masonryItem ownProject" title="{{../project_title}}">
                        <a href="/p/micro/{{../_id}}">
                           <div class="micropost">
                              <div class="micropost_card {{#if ../micro_image}}card_is_micro_image{{else}}{{#if ../micro_audio}}card_is_micro_audio{{else}}{{#if ../micro_video}}card_is_micro_video{{else}}card_is_micro_text{{/if}}{{/if}}{{/if}}">
                                 {{#if ../micro_image}}<img src="https://s3.amazonaws.com/hryzn-app-static-assets/{{../micro_image}}" class="img-responsive" alt="{{../micro_body}}" />{{/if}}
                                 {{#if ../thumbnail_image}}<img src="https://s3.amazonaws.com/hryzn-app-static-assets/{{../thumbnail_image}}" class="img-responsive" alt="{{../micro_body}}" />{{/if}}
                                 {{#if ../micro_video}}<div class="micro_play_btn"><img class="topnav__icon" src="/img/icons/play-button-white.png" /></div>{{/if}}
                                 {{#if ../micro_audio}}<div class="micro_play_btn"><img class="topnav__icon" src="/icons/audio-button-white.png" /></div>{{/if}}
                                 {{#if ../project_title}}<p class="micro_title">{{../project_title}}</p>{{/if}}
                                 <p class="micro_body">{{{../micro_body}}}</p>
                              </div>
                              <a class="micro_tag" href="/profile/{{../project_owner}}">@{{../project_owner}}</a>
                           </div>
                        </a>
                     </div>
                  {{/ifEquals}}
               {{/each}}
            {{else}}
               <div class="masonryItem ownProject" title="{{project_title}}">
                  <a href="/p/micro/{{_id}}">
                     <div class="micropost">
                        <div class="micropost_card {{#if micro_image}}card_is_micro_image{{else}}{{#if micro_audio}}card_is_micro_audio{{else}}{{#if micro_video}}card_is_micro_video{{else}}card_is_micro_text{{/if}}{{/if}}{{/if}}">
                           {{#if micro_image}}<img src="https://s3.amazonaws.com/hryzn-app-static-assets/{{micro_image}}" class="img-responsive" alt="{{micro_body}}" />{{/if}}
                           {{#if thumbnail_image}}<img src="https://s3.amazonaws.com/hryzn-app-static-assets/{{thumbnail_image}}" class="img-responsive" alt="{{micro_body}}" />{{/if}}
                           {{#if micro_video}}<div class="micro_play_btn"><img class="topnav__icon" src="/icons/play-button-white.png" /></div>{{/if}}
                           {{#if micro_audio}}<div class="micro_play_btn"><img class="topnav__icon" src="/icons/audio-button-white.png" /></div>{{/if}}
                           {{#if project_title}}<p class="micro_title">{{project_title}}</p>{{/if}}
                           <p class="micro_body">
                              {{{micro_body}}}
                           </p>
                        </div>
                        <a class="micro_tag {{#if project_title}}micro_tag_w_title{{/if}}" href="/profile/{{project_owner}}">@{{project_owner}}</a>
                     </div>
                  </a>
               </div>
            {{/if}}

            {{else}}

               {{#if posted_to_group}}
                  {{#each posted_to_group}}
                     {{#ifEquals this.group_is_private "true"}}
                        {{! Don't show projects in private groups }}
                     {{else}}
                        <div class="masonryItem ownProject" title="{{../project_title}}">
                           <div class="project_card">
                              <a href="/p/details/{{../id}}" class="project_link">
                                 <img src="https://s3.amazonaws.com/hryzn-app-static-assets/{{#if ../thumbnail_image}}{{../thumbnail_image}}{{else}}{{../project_image}}{{/if}}" class="img-responsive" alt="{{../project_title}}" />
                              </a>
                              <div class="project_card_bottom">
                                 <div class="project_bottom_wrapper">
                                    <div class="bg_overlay"></div>
                                    <div class="project_bottom_details">
                                       <a href="/profile/{{../project_owner}}"><p class="project_owner">@{{../project_owner}}</p></a>
                                       <a href="/p/details/{{../id}}" class="project_link">
                                          <p class="project_card_title">{{../project_title}}</p>
                                       </a>
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                     {{/ifEquals}}
                  {{/each}}
               {{else}}
                  <div class="masonryItem ownProject" title="{{project_title}}">
                     <div class="project_card">
                        <a href="/p/details/{{id}}" class="project_link">
                           <img src="https://s3.amazonaws.com/hryzn-app-static-assets/{{#if thumbnail_image}}{{thumbnail_image}}{{else}}{{project_image}}{{/if}}" class="img-responsive" alt="{{project_title}}" />
                        </a>
                        <div class="project_card_bottom">
                           <div class="project_bottom_wrapper">
                              <div class="bg_overlay"></div>
                              <div class="project_bottom_details">
                                 <a href="/profile/{{project_owner}}"><p class="project_owner">@{{project_owner}}</p></a>
                                 <a href="/p/details/{{id}}" class="project_link">
                                    <p class="project_card_title">{{project_title}}</p>
                                 </a>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
               {{/if}}

            {{/if}}

         {{/if}}

      {{/each}}

   </div>
</div>
{{/if}}

<div class="detailsRepostModal modalBackground">
   <div class="modal-content">

   <div class="modal-header ">
   <p>Where would you like to repost to?</p>
   </div>

   <form title="repost" method="post" action="/p/details/micro/repost/{{project._id}}">
      <input type="hidden" name="username" value="{{user.username}}">
      <input type="hidden" name="project_id" value="{{project.id}}">
      <input type="hidden" name="project_owner" value="{{project.project_owner}}">
      <select data-placeholder="Repost to..." class="chosen-select form__input" name="repost_to">
         <option value=""></option>
         <option value="followers">Followers</option>
         {{#each user.groups}}
         <option value="{{this.group_id}}">Your Group "{{this.group_name}}"</option>
         {{/each}}
      </select>
      <div class="modal-footer">
         <input class="btn__secondary repost_submit" type="submit" value="Repost"/>
         <span class="closeModal btn__primary">Cancel</span>
      </div>
   </form>

   <form title="unrepost" method="post" action="/p/details/micro/unrepost/{{project._id}}">
      <input type="hidden" name="username" value="{{user.username}}">
      <input type="hidden" name="project_id" value="{{project.id}}">
      <input class="btn__secondary unrepost_btn" type="submit" value="I'm actually trying to unrepost this"/>
   </form>

   </div>

</div>

{{#if is_admin_of_project}}
{{! Hidden Delete Modal }}
<div class="popModal modalBackground">
  <div class="modal-content">

    <div class="modal-header ">
      <p>Are You Sure?</p>
    </div>

    <div class="modal-body">
      <p>Deleting this is permanent and cannot be undone.</p>
    </div>

    <div class="modal-footer">
      <a href="/p/details/delete/{{project._id}}" class="btn__secondary project_submit">Yes I'm Sure</a>
      <span class="closeModal btn__primary">Cancel</span>
    </div>

  </div>

</div>

<!-- Loader Balls -->
<div class="loader_project">
   <div class='loader-container'>
      <div class='ball-wrapper'>
         <div class='ball-holder'>
            <div class='ball'></div>
         </div>
         <div class='shadow'></div>
      </div>

      <div class='ball-wrapper'>
         <div class='ball-holder'>
            <div class='ball'></div>
         </div>
         <div class='shadow'></div>
      </div>

      <div class='ball-wrapper'>
         <div class='ball-holder'>
            <div class='ball'></div>
         </div>
         <div class='shadow'></div>
      </div>
      <p class="loader_text">Thank you, the computer is doing its thing.</p>
   </div>
</div>
{{/if}}

<script>
// Copy project details link
function copyLink(text) {
   var pawn = document.createElement("input");
   document.body.appendChild(pawn);
   pawn.setAttribute('value', text);
   pawn.select();
   document.execCommand("copy");
   document.body.removeChild(pawn);

   var check = document.querySelectorAll(".check");
   check.forEach(function(i) {
      i.innerHTML = "&check;"
   });
}
</script>
